name: CI # Continuous Integration

on:
    push:
        branches:
            - main
    pull_request:
    workflow_dispatch:

jobs:
    lint-check:
        name: Lint and Format Check
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up UV Environment
              uses: astral-sh/setup-uv@v5
              with:
                version: "latest" # Or specific version if needed
                # Caching is typically enabled by default with setup-uv

            - name: Initialize Project
              run: make init # Installs deps and pre-commit hooks

            - name: Check Formatting
              run: make fmt-check # Uses ruff format --check

            - name: Run Linters
              run: make lint # Uses ruff check --fix and mypy

    build-and-test:
        name: Build and Test on {{ '${{ matrix.os }}' }}
        runs-on: {{ '${{ matrix.os }}' }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest, windows-latest]
                # Can add Python version matrix here if needed
            fail-fast: false
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up UV Environment
              uses: astral-sh/setup-uv@v5
              with:
                version: "latest"
                # Caching enabled by default

            - name: Initialize Project (Install Dependencies)
              run: make init # Ensures uv sync --dev

            - name: Build Project
              run: make build

            - name: Run Tests
              run: make test

            - name: Smoke Test (Run Application)
              run: make run
